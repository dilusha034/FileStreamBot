<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POP Tv One | {{file_name}}</title>
    <link rel="icon" href="https://raw.githubusercontent.com/dilusha034/FileStreamBot/main/photo_2025-09-24_00-54-09.jpg?v=2" type="image/x-icon">
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/dilusha034/FileStreamBot/main/photo_2025-09-24_00-54-09.jpg?v=2" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/proavipatil/data@main/fs/src/plyr.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/proavipatil/data@main/fs/src/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@500;700&display=swap" rel="stylesheet">
</head>

<body>
    <nav>
        <div class="nleft">
            <a href="#">
                <h3 id="heading" style="z-index: 100; visibility: hidden;" class="magnet title">POP Tv One</h3>
            </a>
        </div>
        <div class="nryt">
            <a class="home-btn magnet" href="#main" onclick="toggleWidthnav(this)">මුල් පිටුව</a>
            <a href="#abtus" class="about-btn magnet" onclick="toggleWidthnav(this)">අපි ගැන</a>
        </div>
    </nav>
    <center>
        <div class="about-nav">
            <a href="#abtus" class="wlcm magnet" onclick="toggleWidth(this)">පිළිගැනීම</a>
            <a href="#channels" class="abt-chnl magnet" onclick="toggleWidth(this)">අපේ චැනල්</a>
            <a href="#contact" class="magnet contact-btn" onclick="toggleWidth(this)">සම්බන්ධ වන්න</a>
        </div>
    </center>

   <div class="outer">
        <div class="inner">
            <div class="main" id="main">
                <video id="player" playsinline controls width="100%"></video>
                <div class="file-name">
                    <h4 style="display: inline;">ගොනුවේ නම: </h4>
                    <p style="display: inline;" id="myDiv">{{file_name}}</p><br>
                    <h4 style="display: inline;">ගොනුවේ ප්‍රමාණය: </h4>
                    <p style="display: inline;">{{file_size}}</p>
                </div>
                <div class="downloadBtn">
                    <button class="magnet" onclick="streamDownload()">
                        <img style="height: 30px;" src="https://i.ibb.co/RjzYttX/dl.png" alt="">බාගත කරන්න
                    </button>
                    <button class="magnet" onclick="copyStreamLink()">
                        <img src="https://i.ibb.co/CM4Y586/link.png" alt="Copy Link">ලින්ක් එක කොපි කරන්න
                    </button>
                    <button class="magnet" onclick="vlc_player()">
                        <img src="https://i.ibb.co/px6fQs1/vlc.png" alt="">VLC Player
                    </button>
                    <button class="magnet" onclick="mx_player()">
                        <img src="https://i.ibb.co/41WvtQ3/mx.png" alt="">MX Player
                    </button>
                </div>
            </div>
            <div class="abt">
                <div class="about">
                    <div class="about-dets">
                        <div class="abt-sec" id="abtus" style="padding: 160px 30px;">
                            <h1 style="text-align: center;">POP TV ONE වෙත <Span>සාදරයෙන්</Span> පිළිගනිමු</h1>
                            <p style="text-align: center; line-height: 2;word-spacing: 2px;  letter-spacing: 0.8px;">
                                මෙය POP Tv One හි නිල චිත්‍රපට සහ කතා මාලා නැරඹීමේ පිටුවයි. ඔබට අවශ්‍ය නම් මෙතනින් කෙලින්ම නැරඹීමට හෝ බාගත කිරීමට හැකිය. 
                                <br><br>ඔබ මෙම සේවාවට කැමති නම්, ඔබේ මිතුරන් සමගද බෙදාගැනීමට අමතක කරන්න එපා!
                            </p>
                        </div>
                        <div class="abt-sec" id="channels">
                            <h1>අපේ <span>TELEGRAM</span> චැනල්</h1>
                            <div class="links chnl-link">
                                <a class="magnet" href="https://t.me/POPTvOne">
                                    <button>POP TV ONE (Movies & TV)</button>
                                </a>
                            </div>
                        </div>
                        <div class="abt-sec" id="contact">
                            <p style="text-align: center;">යම් ගැටළුවක් හෝ දෝෂයක් ඇත්නම්, පහතින් අපව අමතන්න</p>
                            <div class="links contact">
                                <a href="https://t.me/Mr_D_2000">
                                    <button>සම්බන්ධ වන්න (Contact)</button>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <center>
                <div class="copyright">
                    <h5 class="text-center">Copyright © 2025 <a href="https://t.me/POPTvOne"><span
                                style="font-weight: 700;">POP Tv One</span></a>. All
                        Rights Reserved.</h5>
                </div>
            </center>
        </footer>
    </div>
</body>

<script src="https://cdn.plyr.io/3.6.9/plyr.js"></script>

<!-- === මෙන්න අපේ අලුත්ම, බලවත්ම Player Script එක === -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const player = new Plyr('#player');
    const fileName = "{{file_name}}";
    const fileUrl = "{{file_url}}";

    const sources = {
        type: 'video',
        sources: [
            {
                src: fileUrl,
                type: 'video/mp4',
            },
        ],
    };

    // MKV file එකක් නම් පමණක් subtitle track එක එකතු කරනවා
    if (fileName.toLowerCase().endsWith('.mkv')) {
        sources.tracks = [
            {
                kind: 'subtitles',
                label: 'සිංහල',
                srclang: 'si',
                // මෙන්න අර අලුත් subtitle route එකට call කරන තැන
                src: fileUrl.replace('/dl/', '/subtitle/'),
                default: true,
            }
        ];
    }
    
    player.source = sources;
});
</script>

<script src="https://proavipatil.github.io/data/fs/src/script.js"></script>

<!-- === Title එක හංගලා පෙන්නන අපේ script එක === -->
<script>
    window.addEventListener('load', function() {
        const heading = document.getElementById('heading');
        if (heading) {
            heading.textContent = 'POP Tv One';
            heading.style.visibility = 'visible';
        }
    });
</script>

<!-- === අපේ අවසාන පාලන කේතය (The Final Control Code) === -->
<script>
    
    // පිටුවේ ඇති සියලුම දේ (කරදරකාරී script.js ඇතුළුව) load වී අවසන් වන තුරු බලා සිටින්න
    window.addEventListener('load', function() {
        
        // අර script.js එකට player එක හදලා ඉවර කරන්න පොඩි වෙලාවක් දෙමු (මිලි තත්පර 500)
        setTimeout(function() {
            try {
                // --- 1. Player එක අපේ පාලනයට ගැනීම ---
                const videoElement = document.getElementById('player');
                const player = Plyr.get(videoElement); // දැනටමත් හදපු player එක අල්ලගන්නවා

                if (player) {
                    const fileName = "{{file_name}}";
                    const fileUrl = "{{file_url}}";

                    const sources = {
                        type: 'video',
                        title: fileName,
                        sources: [{ src: fileUrl }],
                        tracks: []
                    };

                    // MKV file එකක් නම්, අපේ subtitle පාරෙන් උපසිරැසිය ඉල්ලනවා
                    if (fileName.toLowerCase().endsWith('.mkv')) {
                        sources.tracks.push({
                            kind: 'subtitles',
                            label: 'සිංහල',
                            srclang: 'si',
                            src: fileUrl.replace('/dl/', '/subtitle/'),
                            default: true,
                        });
                        console.log("Subtitle track added for MKV file.");
                    }

                    // Player එකේ source එක, අපේ settings එක්ක update කරනවා
                    player.source = sources;

                    // Player එක play වෙන්න ලෑස්ති වුණාම, subtitle එක on කරනවා
                    player.on('ready', () => {
                        player.toggleCaptions(true);
                    });
                } else {
                    console.error("Plyr player instance not found!");
                }

                // --- 2. Title එක අපේ පාලනයට ගැනීම ---
                const heading = document.getElementById('heading');
                if (heading) {
                    heading.textContent = 'POP Tv One';
                    heading.style.visibility = 'visible';
                }

            } catch (error) {
                console.error("Error in Final Control Code:", error);
            }
        }, 500); // මිලි තත්පර 500ක් පසුව අපේ කේතය ක්‍රියාත්මක කරන්න
    });
</script>
    
</html>
